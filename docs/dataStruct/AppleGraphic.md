### AppleII高解像度グラフィックス領域

#### AppleII高解像度グラフィックス領域の構成

AppleIIの高解像度グラフィックス領域のy座標は, 以下のように分割される:

- Y座標全体は連続した3つの「ブロック」に分割される
- 各ブロックは8つの「ボックス行」に分割される
- 各ボックス行は8つの「ライン行」に分割される

#### 画面上のピクセル座標(x,y)からビデオメモリ書込先アドレスの算出手順

ビデオメモリアドレス上は, 前述の「ブロック」,「ボックス行」, 「ライン行」を以下のように配置している。

- ライン行の幅は40バイトで、どのライン行にも連続したアドレスが64個並んでおり, ライン行内の開始アドレスからのオフセットによって画面上で描画する際のx座標を決定する
- 隣接するボックス行間は, 128バイト離れて配置される
- ボックス行内のライン行間は, 1024バイト離れて配置される

以上から, 画面上の(x,y)座標のピクセルからピクセル情報を設定する場合に使用するビデオメモリアドレスの算出パラメタは, 以下のようになる。

1. ビデオメモリのX座標(列番号)に対応したオフセットアドレス(単位:バイト): x // 7
2. ブロック番号に対応したオフセットアドレス(単位:バイト): 40 \* ( y // 64 )
3. ボックス行番号に対応したオフセットアドレス(単位:バイト): 128 * ( y % 64 ) // 8
4. ボックス行内のライン行に対応したオフセットアドレス(単位:バイト): 1024 \* 8 \* ( y % 8 )

上記の総和が, 出力先のビデオメモリアドレスとなる。

#### AppleIIビデオメモリにおけるピクセルの6色表示制御

AppleIIでは, 1バイトのデータをビデオメモリに書き込むことで, 連続した7ピクセルのON/OFF(発光の有無)を制御する。

書き込みデータ(ビデオメモリに書込む1バイトのデータ)の構成は, 以下の通り(なお, 信号の位相に依存する発色となるため, 実機上は, 明確な青色, 紫色, 燈色, 緑色, 白色, 黒色として表示されるわけではないが, 便宜上以下では, 青色, 紫色, 燈色, 白色, 黒色と表記する):

- 0から6ビット目 発光指示ビット
  0ビットから6ビット目までの画面上の各ビットのON/OFFで左から右へピクセルの
  発光のON/OFFを決定する。

  - ビットが0の場合
    発光しない(黒色になる)

  - ビットが1の場合

    a. 直前(画面左側)のピクセルのビットが立っており, (発光していた)
       両者が補色の関係(緑,紫の組, または, 橙,青の組)にある場合は, 対象ピクセルを白として発光する(補色により白に見える)。

    b. 直前(画面左側)のピクセルのビットが立っていない場合
       書き込みデータ7ビット目のカラー選択ビットと対象ビットによって発光されるビデオメモリ上のピクセルのX座標の値によって, 発光色を決定する。

- 7ビット目  カラー選択ビット
  最上位ビットは, カラー選択ビットとなっており, 直前のピクセルのビットが
  立っていない場合, バイトの最上位ビットと対象ビットによって発光される
  ビデオメモリ上のピクセルのX座標の値によって, 発光色を選択する。

発光色の選択は, 以下のように決定される。

  1. ビデオメモリ上のピクセルのX座標が偶数の場合, かつ,

     a. カラー選択ビットが立っていたら, 青色を発光する。

     b. カラー選択ビットが立っていなければ, 紫色を発光する。

  2. ビデオメモリ上のピクセルのX座標が奇数の場合, かつ,

     a. カラー選択ビットが立っていたら, 橙色を発光する。

     b. カラー選択ビットが立っていなければ, 緑色を発光する。
